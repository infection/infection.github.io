
<!DOCTYPE html>
<html lang="en">
    <head><meta name="generator" content="Hexo 3.8.0">
        <title>What's new in Infection 0.16.0 — Infection PHP</title>
        <meta charset="utf-8">
        <meta name="description" content="Infection - PHP Mutation Testing Framework.">
        <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">

        <meta property="og:type" content="article">
        <meta property="og:title" content="What's new in Infection 0.16.0 — Infection PHP">
        <meta property="og:description" content="Infection - PHP Mutation Testing Framework.">
        <meta property="og:image" content="https://infection.github.io//images/logo.png">

        <meta name="twitter:card" content="summary">
        <meta name="twitter:title" content="What's new in Infection 0.16.0 — Infection PHP">
        <meta name="twitter:description" content="Infection - PHP Mutation Testing Framework.">
        <meta name="twitter:image" content="https://infection.github.io/images/logo.png">

        <link rel="apple-touch-icon" sizes="180x180" href="/images/icons/apple-touch-icon.png">
        <link rel="icon" type="image/png" sizes="192x192" href="/images/icons/android-icon-192x192.png">
        <link rel="icon" type="image/png" sizes="32x32" href="/images/icons/favicon-32x32.png">
        <link rel="icon" type="image/png" sizes="16x16" href="/images/icons/favicon-16x16.png">
        <link rel="icon" href="/images/logo.png" type="image/png">

        <meta name="msapplication-TileColor" content="#4fc08d">
        <meta name="theme-color" content="#4fc08d">

        <meta name="msapplication-config" content="browserconfig.xml">
        <link rel="manifest" href="/manifest.json">

        <link href="//fonts.googleapis.com/css?family=Source+Sans+Pro:300,400,600|Roboto Mono" rel="stylesheet" type="text/css">
        <link href="//fonts.googleapis.com/css?family=Dosis:500&text=Infection PHP" rel="stylesheet" type="text/css">

        <!-- main page styles -->
        <link rel="stylesheet" href="/css/page.css">

        <!-- this needs to be loaded before guide's inline scripts -->
        <script src="/js/vue.js"></script>
        <script>window.PAGE_TYPE = "{{type}}"</script>
    </head>
    <body class="docs">        <div id="mobile-bar">
            <a class="menu-button"></a>
            <a class="logo" href="/"></a>
        </div>
        <div id="header">
  <a id="logo" href="/">
    <img src="/images/logo.png">
    <span>Infection</span>
  </a>
  <ul id="nav">
    <li>
  <form id="search-form">
    <input type="text" id="search-query-nav" class="search-query st-default-search-input">
  </form>
</li>
<li><a href="/guide/" class="nav-link">Guide</a></li>
<li><a href="https://infection-php.dev/" target="_blank">Playground</a></li>
<li><a href="https://github.com/infection/infection" target="_blank">GitHub</a></li>
<li class="nav-dropdown-container ecosystem">
  <a class="nav-link">Ecosystem</a><span class="arrow"></span>
  <ul class="nav-dropdown">
    <li><h4>Help</h4></li>
    <li><ul>
      <li><a href="https://twitter.com/infection_php" class="nav-link" target="_blank">Twitter</a></li>
      <li><a href="https://mastodon.social/@infection_php" class="nav-link" target="_blank">Mastodon </a></li>
      <li><a href="https://discord.gg/ZUmyHTJ" class="nav-link" target="_blank">Discord </a></li>
      <li><a href="https://github.com/infection/infection/discussions" class="nav-link" target="_blank">Infection Discussions </a></li>
    </ul></li>
    <li><h4>Resource Lists</h4></li>
    <li><ul>
      <li><a href="https://github.com/infection" class="nav-link" target="_blank">Official Repos</a></li>
    </ul></li>
  </ul>
</li>



<li>
    <a id="theme-toggle" style="cursor: pointer;">
        <i id="theme-toggle-icon" class="theme-icon"></i>
    </a>
</li>

  </ul>
</div>

        
            <div id="main" class="fix-sidebar">
                
                    <div class="sidebar blog">
    <ul class="main-menu">
        <li>
  <form id="search-form">
    <input type="text" id="search-query-nav" class="search-query st-default-search-input">
  </form>
</li>
<li><a href="/guide/" class="nav-link">Guide</a></li>
<li><a href="https://infection-php.dev/" target="_blank">Playground</a></li>
<li><a href="https://github.com/infection/infection" target="_blank">GitHub</a></li>
<li class="nav-dropdown-container ecosystem">
  <a class="nav-link">Ecosystem</a><span class="arrow"></span>
  <ul class="nav-dropdown">
    <li><h4>Help</h4></li>
    <li><ul>
      <li><a href="https://twitter.com/infection_php" class="nav-link" target="_blank">Twitter</a></li>
      <li><a href="https://mastodon.social/@infection_php" class="nav-link" target="_blank">Mastodon </a></li>
      <li><a href="https://discord.gg/ZUmyHTJ" class="nav-link" target="_blank">Discord </a></li>
      <li><a href="https://github.com/infection/infection/discussions" class="nav-link" target="_blank">Infection Discussions </a></li>
    </ul></li>
    <li><h4>Resource Lists</h4></li>
    <li><ul>
      <li><a href="https://github.com/infection" class="nav-link" target="_blank">Official Repos</a></li>
    </ul></li>
  </ul>
</li>



<li>
    <a id="theme-toggle" style="cursor: pointer;">
        <i id="theme-toggle-icon" class="theme-icon"></i>
    </a>
</li>

    </ul>
    <div class="list">
        <h2>
            Recent Posts
            <a href="/atom.xml" target="_blank" style="vertical-align: middle; margin-left: 5px">
                <img src="/images/feed.png" style="width:15px;height:15px">
            </a>
        </h2>
        <ul style="padding:0">
        
            <li>
                <a href="/2022/01/10/whats-new-in-0.26.0/" class="sidebar-link">What's new in Infection 0.26.0</a>
            </li>
        
            <li>
                <a href="/2021/09/06/whats-new-in-0.25.0/" class="sidebar-link">What's new in Infection 0.25.0</a>
            </li>
        
            <li>
                <a href="/2021/07/27/whats-new-in-0.24.0/" class="sidebar-link">What's new in Infection 0.24.0</a>
            </li>
        
            <li>
                <a href="/2021/05/13/whats-new-in-0.23.0/" class="sidebar-link">What's new in Infection 0.23.0</a>
            </li>
        
            <li>
                <a href="/2021/01/27/whats-new-in-0.21.0/" class="sidebar-link">What's new in Infection 0.21.0</a>
            </li>
        
            <li>
                <a href="/2020/11/01/whats-new-in-0.20.0/" class="sidebar-link">What's new in Infection 0.20.0</a>
            </li>
        
            <li>
                <a href="/2020/10/28/whats-new-in-0.19.0/" class="sidebar-link">What's new in Infection 0.19.0</a>
            </li>
        
            <li>
                <a href="/2020/10/17/whats-new-in-0.18.0/" class="sidebar-link">What's new in Infection 0.18.0</a>
            </li>
        
            <li>
                <a href="/2020/08/18/whats-new-in-0.17.0/" class="sidebar-link">What's new in Infection 0.17.0</a>
            </li>
        
            <li>
                <a href="/2020/03/28/whats-new-in-0.16.0/" class="sidebar-link current">What's new in Infection 0.16.0</a>
            </li>
        
        </ul>
    </div>
</div>
<div class="content with-sidebar blog post">
    <h1>What's new in Infection 0.16.0</h1>
    <h4>Mar 28, 2020</h4>
    <p>Release: <a href="https://github.com/infection/infection/releases/tag/0.16.0" target="_blank" rel="noopener">https://github.com/infection/infection/releases/tag/0.16.0</a></p>
<h2 id="BC-Breaks"><a href="#BC-Breaks" class="headerlink" title="BC Breaks"></a>BC Breaks</h2><ul>
<li>Infection now requires PHP 7.3.12+. If you can’t upgrade for some reason upgrade, don’t worry, you can still use previous versions.</li>
<li>We had <a href="https://github.com/infection/infection/pull/1105" target="_blank" rel="noopener">a bug</a> with the config file loading order. Instead of trying to load the file <code>infection.json</code> and if not found, try to load <code>infection.json.dist</code>, it was doing this in a reverse order, stopping at <code>infection.json.dist</code>. If you have both <code>infection.json</code> and <code>infection.json.dist</code>, please note that the first will be used like it should, unlike before.</li>
</ul>
<h2 id="Performance-improvements"><a href="#Performance-improvements" class="headerlink" title="Performance improvements"></a>Performance improvements</h2><h3 id="Allow-the-initial-test-suite-to-be-skipped-skip-initial-tests"><a href="#Allow-the-initial-test-suite-to-be-skipped-skip-initial-tests" class="headerlink" title="Allow the initial test suite to be skipped (--skip-initial-tests)"></a>Allow the initial test suite to be skipped (<code>--skip-initial-tests</code>)</h3><p>Typically Infection first executes your test suite without any modification to ensure it passes. This is so even if you provide needed coverage reports, with only difference in that Infection will not attempt to generate it again from this test run.</p>
<p>However, since many may already run the tests in another context, for example to retrieve a specific coverage format, requiring to run the test suite another time may be a slow and redundant step. For this reason, the <code>--skip-initial-tests</code> option has been added. Note that to be able to use this option, you <strong>must</strong> provide the code coverage with the <code>--coverage</code> option.</p>
<p class="tip">Note that it is extremely important that you ensure the test suite is passing and the coverage used up to date. Otherwise some mutations might be incorrectly caught or a coverage-related error thrown in the middle of the mutation run.</p>

<h3 id="Enchanced-streaming-procedure-no-progress"><a href="#Enchanced-streaming-procedure-no-progress" class="headerlink" title="Enchanced streaming procedure (--no-progress)"></a>Enchanced streaming procedure (<code>--no-progress</code>)</h3><p>In 0.15.x and earlier Infection was entirely sequential in its preparation steps. It collected source files as configured, parsed all and every coverage report, prepared every single mutation, and only then went to business. This lead to some undesired consequences for larger projects. Namely, parsing a lot of coverage reports at once required much more memory than available on a typical developer or CI machine.</p>
<p>As of 0.16 Infection would still behave about the same by default, but there’s another mode of operation, toggled by specifying <code>--no-progress</code> option. Which option enables Infection to stream coverage reports right into mutations, <a href="https://github.com/infection/infection/pull/1106" target="_blank" rel="noopener">parsing coverage reports and files one by one as needed</a>, while also enabling Infection <a href="https://github.com/infection/infection/pull/1082" target="_blank" rel="noopener">to leverage poll gaps between mutated processes to do additional work</a>. Therefore it is important to note that this new process works best with the <code>--threads</code> options, e.g. as in <code>--no-progress --threads=4</code>.</p>
<p>There’s a slight downside: because Infection won’t buffer and count every mutation before trying them, in this mode Infection won’t report in real-time the remaining number of mutations to try. This downside is unfortunate, but for CI usage it should not be a cause of concerns.</p>
<h3 id="Various-performance-improvements"><a href="#Various-performance-improvements" class="headerlink" title="Various performance improvements"></a>Various performance improvements</h3><p>There were other improvements performance wise:</p>
<ul>
<li>The lookup and sorting of the tests have been optimized. After creating a mutation, Infection looks up which tests to execute for it, and orders those tests from fastest to slowest. Since this operation is done for each mutation, this is a very hot path in Infection. The lookup process and the sorting strategy have been adjusted and optimized for different use cases in order to speed up the process. Although these changes offer only minor improvements for smaller projects, they may have a measurable effect on larger projects.</li>
<li>Previously we required a <code>MutantProcess</code> to record the results in order to log it in the different log files. This was an easy choice because this object could provide all the necessary information. However, in the case of mutations not executed by the tests, this translated into unnecessary operations: creating the process and dumping the framework adapter configuration. As a result, we decoupled the logged results from <code>MutantProcess</code>, allowing us to filter out those non-covered mutations earlier in the process while still being able to log them.</li>
</ul>
<h2 id="Splitting-Infection-by-separate-Packages"><a href="#Splitting-Infection-by-separate-Packages" class="headerlink" title="Splitting Infection by separate Packages"></a>Splitting Infection by separate Packages</h2><p>As the support for more test frameworks is being added, a number of problem surfaced (you can read a more detailed explanation as of why in <a href="https://github.com/infection/infection/issues/922" target="_blank" rel="noopener">this RFC</a>). To palliate to this, we decided to split some parts of Infection such as the <code>PhpSpec</code> and <code>Codeception</code> test framework adapters info different packages.</p>
<p>You can read a very detailed explanation about why was it needed in <a href="https://github.com/infection/infection/issues/922" target="_blank" rel="noopener">this RFC</a>.</p>
<p>In a nutshell, this is useful both for the end user and for maintainers:</p>
<ul>
<li>you will not download not needed code if you don’t use those test frameworks when installing Infection as a Composer package which also allows to reduce the risk of package conflicts</li>
<li>you will not need to upgrade Infection for patches or improvements made on the test framework adapters that you don’t use</li>
<li>Clearer test framework adapters dependencies and requirements</li>
</ul>
<p>To ensure this change does not affect the user-experience of those using other test frameworks than PHPUnit, Infection will be able to automatically pick up that you are missing the test framework adapter package and propose you to install it for you.</p>
<p>List of new packages:</p>
<ul>
<li><a href="https://github.com/infection/codeception-adapter" target="_blank" rel="noopener"><code>infection/codeception-adapter</code></a></li>
<li><a href="https://github.com/infection/phpspec-adapter" target="_blank" rel="noopener"><code>infection/phpspec-adapter</code></a></li>
<li><a href="https://github.com/infection/abstract-testframework-adapter" target="_blank" rel="noopener"><code>infection/abstract-testframework-adapter</code></a> - interfaces for any testframework adapter</li>
<li><a href="https://github.com/infection/extension-installer" target="_blank" rel="noopener"><code>infection/extension-installer</code></a> - autodiscovery of installed adapters. No need to add them to <code>infection.json</code>, just install a Composer package and you are done. Inspired by PHPStan and Psalm plugin system.</li>
<li><a href="https://github.com/infection/include-interceptor" target="_blank" rel="noopener"><code>infection/include-interceptor</code></a> - Stream Wrapper. Allows to replace included (autoloaded) file with another one (magic that replaces your code with a mutated one) </li>
</ul>
<h2 id="Mutation-Badge"><a href="#Mutation-Badge" class="headerlink" title="Mutation Badge"></a>Mutation Badge</h2><p>It is possible to create a badge displaying your mutation score (check <a href="/guide/mutation-badge.html">here</a> for more details), however this feature was limited to Travis CI only.</p>
<p>In 0.16.x, we switched to <a href="https://github.com/OndraM/ci-detector" target="_blank" rel="noopener"><code>ondram/ci-detector</code></a> in order to expend the support of this feature to more CIs such as GitHub Actions, CircleCI, GitLab and others. The complete list can be found <a href="https://github.com/OndraM/ci-detector#supported-continuous-integration-servers" target="_blank" rel="noopener">here</a>.</p>
<p>Now, thanks to <a href="https://github.com/OndraM/ci-detector" target="_blank" rel="noopener"><code>ondram/ci-detector</code></a>, the mutation badge can be used for <a href="https://github.com/OndraM/ci-detector#supported-continuous-integration-servers" target="_blank" rel="noopener">CI servers supported by this library</a>, including GitHub Actions, CircleCI, GitLab and so on.</p>
<p>Feel free to request an additional integration there if the list of currently supported continuous-integration servers does not contain a service you require.</p>
<blockquote>
<p>Read more about how to setup <a href="/guide/mutation-badge.html">Mutation Badge</a></p>
</blockquote>
<h2 id="Global-ignore-feature-for-Mutators-and-Profiles"><a href="#Global-ignore-feature-for-Mutators-and-Profiles" class="headerlink" title="Global ignore feature for Mutators and Profiles"></a>Global ignore feature for Mutators and Profiles</h2><p>Infection allows adding a configuration to ignore some parts of your code, <a href="/guide/how-to.html#How-to-disable-Mutators-and-profiles">such as a class, a method or a specific line</a> for a given mutator. For example with:</p>
<figure class="highlight json"><table><tr><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    <span class="attr">"mutators"</span>: &#123;</span><br><span class="line">        <span class="attr">"@default"</span>: <span class="literal">true</span>,</span><br><span class="line">        <span class="attr">"TrueValue"</span>: &#123;</span><br><span class="line">            <span class="attr">"ignore"</span>: [</span><br><span class="line">                <span class="string">"NameSpace\\*\\SourceClass::create"</span>,</span><br><span class="line">                <span class="string">"Full\\NameSpaced\\Class"</span></span><br><span class="line">            ]</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>You might however find yourself in the situation where you want to do this for all mutators. If you only have the <code>@default</code> profile enabled, this is a simple task. But if you have several mutators listed, you are out of luck and will find yourself having to do a very repetitive, error prone task which is also non-trivial to keep up to date.</p>
<p>In 0.16.x, we are introducing the <code>global-ignore</code> setting which allows to define an <code>ignore</code> setting which will be added to <em>all</em> mutators. For example:</p>
<figure class="highlight json"><table><tr><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    <span class="attr">"mutators"</span>: &#123;</span><br><span class="line">        <span class="attr">"@default"</span>: <span class="literal">true</span>,</span><br><span class="line">        <span class="attr">"global-ignore"</span>: [</span><br><span class="line">            <span class="string">"FooClass::__construct"</span></span><br><span class="line">        ],</span><br><span class="line">        <span class="attr">"TrueValue"</span>: &#123;</span><br><span class="line">            <span class="attr">"ignore"</span>: [</span><br><span class="line">                <span class="string">"NameSpace\\*\\SourceClass::create"</span>,</span><br><span class="line">                <span class="string">"Full\\NameSpaced\\Class"</span></span><br><span class="line">            ]</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>Will result in <em>all</em> mutators referenced by <code>@default</code> to have the following <code>ignore</code> setting:</p>
<figure class="highlight json"><table><tr><td class="code"><pre><span class="line">[<span class="string">"FooClass::__construct"</span>]</span><br></pre></td></tr></table></figure>
<p>And <code>TrueValue</code> will have:</p>
<figure class="highlight json"><table><tr><td class="code"><pre><span class="line">[</span><br><span class="line">    <span class="string">"FooClass::__construct"</span>,</span><br><span class="line">    <span class="string">"NameSpace\\*\\SourceClass::create"</span>,</span><br><span class="line">    <span class="string">"Full\\NameSpaced\\Class"</span></span><br><span class="line">]</span><br></pre></td></tr></table></figure>
<h2 id="Notice-to-increase-min-MSI-metrics"><a href="#Notice-to-increase-min-MSI-metrics" class="headerlink" title="Notice to increase min MSI metrics"></a>Notice to increase min MSI metrics</h2><p>While this is not the recommended way<code>*</code>, it is possible to use the options <code>--min-msi</code> and/or <code>--min-covered-msi</code> options to force a certain threshold (the Infection process will exit with the error code <code>1</code> if one of those is not reached). When using Infection with those, Infection would also now display a recommendation to increase this threshold when the score is above the configured threshold:</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">! [NOTE] The MSI is 2.5787422095418% percent points over the required MSI.     </span><br><span class="line">!        Consider increasing the required MSI percentage the next time you run </span><br><span class="line">!        infection.</span><br></pre></td></tr></table></figure>
<p><code>*</code>: The MSI score is but a metric like another. The interesting part is not necessarily the score but which mutations escaped and whether or not those should be caught. Moreover if you are using Infection in an incremental way, i.e. running it only the changed files, this metric will drastically vary from a change to another depending of how testing this part is making it unsuitable for this use case.</p>
<h2 id="Codeception’s-Cest-files-support"><a href="#Codeception’s-Cest-files-support" class="headerlink" title="Codeception’s Cest files support"></a>Codeception’s Cest files support</h2><p>It’s now possible to use <a href="https://codeception.com/docs/07-AdvancedUsage#Cest-Classes" target="_blank" rel="noopener">Cest files</a> (Codeception Tests) with Infection. Due to how this type of tests work, it was not possible to generate a correct JUnit report for them.</p>
<p>Now they are fully supported</p>
<hr>
<p>Enjoy!</p>
<p><a class="github-button" href="https://github.com/infection/infection" data-icon="octicon-star" data-show-count="true" aria-label="Star infection/infection on GitHub" target="_blank" rel="noopener">Star</a></p>
<script async defer src="https://buttons.github.io/buttons.js"></script>

</div>

                
            </div>
            <script src="/js/smooth-scroll.min.js"></script>
        

        <!-- main custom script for sidebars, version selects etc. -->
        <script src="/js/css.escape.js"></script>
        <script src="/js/common.js"></script>
        <script src="/js/theme-switch.js"></script>

        <!-- search -->
        <link rel="stylesheet" href="https://cdn.jsdelivr.net/docsearch.js/2/docsearch.min.css">
        <link rel="stylesheet" href="/css/search.css">
        <script type="text/javascript" src="https://cdn.jsdelivr.net/docsearch.js/2/docsearch.min.js"></script>
        <script>
        [
          '#search-query-nav',
          '#search-query-sidebar',
          '#search-query-menu'
        ].forEach(function (selector) {
          if (!document.querySelector(selector)) return
          docsearch({
              apiKey: '75081c711113ff76f9ed83bf001741a1',
              indexName: 'infection',
              inputSelector: selector,
              debug: false // Set debug to true if you want to inspect the dropdown
          });
        })
        </script>

        <!-- fastclick -->
        <script src="//cdnjs.cloudflare.com/ajax/libs/fastclick/1.0.6/fastclick.min.js"></script>
        <script>
        document.addEventListener('DOMContentLoaded', function() {
          FastClick.attach(document.body)
        }, false)
        </script>
    </body>
</html>
